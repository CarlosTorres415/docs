<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.72">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Flashbots Docs Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Flashbots Docs Blog Atom Feed">
<link rel="search" type="application/opensearchdescription+xml" title="Flashbots Docs" href="/opensearch.xml">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous"><title data-react-helmet="true">codebase - design | Flashbots Docs</title><meta data-react-helmet="true" property="og:url" content="https://docs.flashbots.net/flashbots-data/mev-inspect-rs/inspect-codebase-design"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:version" content="current"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="codebase - design | Flashbots Docs"><meta data-react-helmet="true" name="description" content="mev-inspect aims to quantify a lower bound of MEV extracted on Ethereum from txs such as arbitrage and liquidations. The profits are denominated in Ether and for cases where the reward is extracted in a non-ETH token, we query the historical price (via uniswap) and convert it accordingly. Additionally, we also count as MEV txs transactions with failed arb attempts and liquidation checks (where they might decide to check if the position is still liquidatable and halt accordingly) as they still end up paying the miner a gas fee."><meta data-react-helmet="true" property="og:description" content="mev-inspect aims to quantify a lower bound of MEV extracted on Ethereum from txs such as arbitrage and liquidations. The profits are denominated in Ether and for cases where the reward is extracted in a non-ETH token, we query the historical price (via uniswap) and convert it accordingly. Additionally, we also count as MEV txs transactions with failed arb attempts and liquidation checks (where they might decide to check if the position is still liquidatable and halt accordingly) as they still end up paying the miner a gas fee."><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://docs.flashbots.net/flashbots-data/mev-inspect-rs/inspect-codebase-design"><link data-react-helmet="true" rel="alternate" href="https://docs.flashbots.net/flashbots-data/mev-inspect-rs/inspect-codebase-design" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://docs.flashbots.net/flashbots-data/mev-inspect-rs/inspect-codebase-design" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.3ebe4b5e.css">
<link rel="preload" href="/assets/js/styles.2159608c.js" as="script">
<link rel="preload" href="/assets/js/runtime~main.4243c76c.js" as="script">
<link rel="preload" href="/assets/js/main.05bedf1c.js" as="script">
<link rel="preload" href="/assets/js/1.38c3a7ea.js" as="script">
<link rel="preload" href="/assets/js/2.91fce330.js" as="script">
<link rel="preload" href="/assets/js/56.e44f6f4e.js" as="script">
<link rel="preload" href="/assets/js/59.52cdafe0.js" as="script">
<link rel="preload" href="/assets/js/935f2afb.9ac4200a.js" as="script">
<link rel="preload" href="/assets/js/17896441.cb8506b3.js" as="script">
<link rel="preload" href="/assets/js/5c642f0e.ad05923a.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#main" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle" type="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><img src="/img/logo.png" alt="Flashbots Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/logo.png" alt="Flashbots Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title">Flashbots Docs</strong></a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/flashbots/docs" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_GrZ2"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_71bT">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">ðŸŒž</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img src="/img/logo.png" alt="Flashbots Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/logo.png" alt="Flashbots Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title">Flashbots Docs</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a href="https://github.com/flashbots/docs" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper main-docs-wrapper"><div class="docPage_31aa"><div class="docSidebarContainer_3Kbt" role="complementary"><div class="sidebar_15mo"><div class="menu menu--responsive thin-scrollbar menu_Bmed"><button aria-label="Open menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_fgN0" width="24" height="24" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/">welcome to flashbots</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">flashbots auction</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/flashbots-auction/overview">overview</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/flashbots-auction/upgrade-process">upgrade process</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">for searchers</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/flashbots-auction/searchers/quick-start">quick start</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/flashbots-auction/searchers/faq">FAQ</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">advanced concepts</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/flashbots-auction/searchers/advanced/understanding-bundles">understanding bundles</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/flashbots-auction/searchers/advanced/coinbase-payment">coinbase.transfer()</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/flashbots-auction/searchers/advanced/bundle-pricing">bundle pricing</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/flashbots-auction/searchers/advanced/rpc-endpoint">RPC endpoint</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/flashbots-auction/searchers/advanced/reputation">searcher reputation</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/flashbots-auction/searchers/advanced/goerli-testnet">goerli testnet</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/flashbots-auction/searchers/advanced/eip1559">eip-1559 support</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">example searchers</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/flashbots-auction/searchers/example-searchers/simple-arbitrage-bot">simple arbitrage bot</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/flashbots-auction/searchers/example-searchers/searcher-sponsored-tx">searcher sponsored tx</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">libraries</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/flashbots-auction/searchers/libraries/golang">golang provider</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/flashbots-auction/searchers/libraries/ethers-js-provider">ethers.js provider</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/flashbots-auction/searchers/libraries/web3py-provider">web3.py provider</a></li></ul></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/flashbots-auction/other-resources">other resources</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">for miners &amp; mining pools</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/flashbots-auction/miners/quick-start">onboarding</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/flashbots-auction/miners/how-it-works">how it works?</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/flashbots-auction/miners/discord-setup">discord setup</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/flashbots-auction/miners/faq">FAQ</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">advanced concepts</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/flashbots-auction/miners/advanced/source-code">source code</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/flashbots-auction/miners/advanced/interacting-with-relay">interacting with relay</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">mev-geth spec</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/flashbots-auction/miners/mev-geth-spec/v04">v0.4</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/flashbots-auction/miners/mev-geth-spec/v04-rpc">v0.4 RPC</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/flashbots-auction/miners/mev-geth-spec/v03">v0.3</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/flashbots-auction/miners/mev-geth-spec/v03-rpc">v0.3 RPC (current)</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/flashbots-auction/miners/mev-geth-spec/v02">v0.2</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/flashbots-auction/miners/mev-geth-spec/v02-rpc">v0.2 RPC</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/flashbots-auction/miners/mev-geth-spec/v01">v0.1</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/flashbots-auction/miners/mev-geth-spec/v01-rpc">v0.1 RPC</a></li></ul></li></ul></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">releases</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/flashbots-auction/releases/alpha-v0.4">alpha-v0.4 (testing)</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/flashbots-auction/releases/alpha-v0.3">alpha-v0.3 (current)</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/flashbots-auction/releases/alpha-v0.2">alpha-v0.2</a></li></ul></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">flashbots data</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/flashbots-data/blockapi">mev-blocks API</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/flashbots-data/mev-explore">mev-explore</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/flashbots-data/dashboard">flashbots dashboard</a></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!" tabindex="0">mev-inspect</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/flashbots-data/mev-inspect-rs/inspect-quick-start">quick start</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/flashbots-data/mev-inspect-rs/inspect-codebase-design">codebase - design</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/flashbots-data/mev-inspect-rs/inspect-codebase-deep-dive">codebase - deep dive</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/flashbots-data/mev-inspect-rs/inspect-inspector-example">sample flow - liquidation tx</a></li></ul></li></ul></li><li class="menu__list-item"><a class="menu__link" href="/community-tools">community tools</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">contribute</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/contribution-guide">docs contribution guide</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/cheatsheet">cheatsheet</a></li></ul></li><li class="menu__list-item"><a href="https://discord.gg/7hvTycdNcK" target="_blank" rel="noopener noreferrer" class="menu__link menuLinkExternal_1OhN">Discord</a></li><li class="menu__list-item"><a href="https://github.com/flashbots/docs" target="_blank" rel="noopener noreferrer" class="menu__link menuLinkExternal_1OhN">GitHub</a></li></ul></div></div></div><main class="docMainContainer_3ufF"><div class="container padding-vert--lg docItemWrapper_3FMP"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><header><h1 class="docTitle_3a4h">codebase - design</h1></header><div class="markdown"><p>mev-inspect aims to quantify a lower bound of MEV extracted on Ethereum from txs such as arbitrage and liquidations. The profits are denominated in Ether and for cases where the reward is extracted in a non-ETH token, we query the historical price (via uniswap) and convert it accordingly. Additionally, we also count as MEV txs transactions with failed arb attempts and liquidation checks (where they might decide to check if the position is still liquidatable and halt accordingly) as they still end up paying the miner a gas fee.</p><p>Components:</p><ul><li>Inspectors<ul><li>Examines transactions to see if they belong to a relevant protocol we&#x27;re interested in
are &quot;parsers&quot; that know how a given contract is set up, and are able to extract necessary fields</li></ul></li><li>Reducers and Processor<ul><li>Goes through the relavent fields to check for MEV, quantify/identify them, and store it into the <code>mev-inspections</code> table of the database</li></ul></li></ul><p>Protocols supported (as defined in <code>src/inspectors</code>):</p><ul><li>Uniswap (+ forks with shared ABI)</li><li>Balancer</li><li>Curve</li><li>0x</li><li>Aave</li><li>Compound</li><li>DyDx</li></ul><p>Action types stored (as defined in <code>src/reducers</code>):</p><ul><li>Arbitrage</li><li>Liquidations<ul><li>Including LiquidationCheck</li></ul></li><li>Trades<ul><li>We store trades even if they&#x27;re not a complete arb in order to identify arb captured across multiple transactions in subsequent blocks</li></ul></li><li>AddLiquidity</li><li>WETH deposits/withdrawals</li><li>Token Transfers</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="tracing"></a>tracing:<a class="hash-link" href="#tracing" title="Direct link to heading">#</a></h3><p>Direct ETH/token transfers, trades routed through an aggregator or a router are trivial to parse/filter (by looking at the tx input data + receipts) but contract interactions (which bots often employ) can be complex to identify. Transaction tracing allows us to dig deeper into the tx execution cycle to look through the state changes, internal calls and additional proxy contracts the tx interacts with. mev-inspect uses OpenEthereum archive node traces with the following types (by action_type):</p><ul><li><code>Call</code>, which happens when a method on the same contract or a different one is executed. We can identify the input parameters in each instance by looking at this trace.</li><li><code>Self-destruct</code>, when a arbitrage contract destroys the code at its address and transfers the ETH held in the contract to an EOA. Common pattern among searchers given gas refunds.</li><li><code>Create</code>, when a contract deploys another contract (and potentially transfers assets to it).</li><li><code>Reward</code>, pertaining to the block reward and uncle reward.</li></ul><p>On proxy implementation:</p><p>Aside from the eoa that initiates the transaction and the recepient (which can be another eoa or a contract), we are also interested in identifying any proxy implementations used during MEV extraction. We do that by iterating over the traces to find delegate calls originating from the contract to any other proxy implementations.</p><p><img src="https://camo.githubusercontent.com/7cde2d066ebfa7c38adc324dc955e42278fa114d253d3804f3f85d20f7ace39a/68747470733a2f2f692e696d6775722e636f6d2f30564a694562762e706e67" alt="delegate_call_illustration"></p><p>More on delegate calls <a href="https://medium.com/coinmonks/delegatecall-calling-another-contract-function-in-solidity-b579f804178c" target="_blank" rel="noopener noreferrer">here</a></p><p>Deeper dive into the rust implementation specifics <a href="https://github.com/worldveil/mev-inspect-rs/blob/master/NOTES.md" target="_blank" rel="noopener noreferrer">here</a></p></div></article><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/flashbots-data/mev-inspect-rs/inspect-quick-start"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« quick start</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/flashbots-data/mev-inspect-rs/inspect-codebase-deep-dive"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">codebase - deep dive Â»</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#tracing" class="table-of-contents__link">tracing:</a></li></ul></div></div></div></div></main></div></div></div>
<script src="/assets/js/styles.2159608c.js"></script>
<script src="/assets/js/runtime~main.4243c76c.js"></script>
<script src="/assets/js/main.05bedf1c.js"></script>
<script src="/assets/js/1.38c3a7ea.js"></script>
<script src="/assets/js/2.91fce330.js"></script>
<script src="/assets/js/56.e44f6f4e.js"></script>
<script src="/assets/js/59.52cdafe0.js"></script>
<script src="/assets/js/935f2afb.9ac4200a.js"></script>
<script src="/assets/js/17896441.cb8506b3.js"></script>
<script src="/assets/js/5c642f0e.ad05923a.js"></script>
</body>
</html>